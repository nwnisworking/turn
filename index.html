<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebRTC Test</title>
</head>
<body>
  <video id="bob"></video>
  <script type="module" src="rtc.js">

    // await new Promise(res=>{setTimeout(res, 1000)})

    // const alice = new RTCPeerConnection({
    //   iceServers : [
    //     {urls : 'turn:192.168.18.4:9000', username : 'alice', credential : 'test'}
    //   ],
    //   iceTransportPolicy : 'relay'
    // })

    // const bob = new RTCPeerConnection({
    //   iceServers : [
    //     {urls : 'turn:192.168.18.4:9000', username : 'bob', credential : 'test'}
    //   ],
    //   iceTransportPolicy : 'relay'
    // })

    // navigator.mediaDevices.getDisplayMedia({audio : true, video : true}).then(e=>{
    //   e.getTracks().forEach(e=>alice.addTrack(e))
    // })

    // const stream = window.stream = await navigator.mediaDevices.getDisplayMedia({audio : true, video : true})


    // function update(rtc, option){
    //   const candidates = []

    //   rtc.setLocalDescription(option)
      
    //   return new Promise((res, rej)=>{
    //     rtc.onicecandidate = ({candidate})=>candidate ? candidates.push(candidate) : res({candidates, option})
    //   })


    // }

    // alice.createDataChannel('comm')

    // const a2b = await alice.createOffer({offerToReceiveAudio : true, offerToReceiveVideo : true}).then(update.bind(null, alice))
    // console.log(alice)    

    // bob.setRemoteDescription(a2b.option)
    // a2b.candidates.forEach(e=>bob.addIceCandidate(e))
   
    // const b2a = await bob.createAnswer({offerToReceiveAudio : true, offerToReceiveVideo : true}).then(update.bind(null, bob))

    // alice.setRemoteDescription(b2a.option)
    // b2a.candidates.forEach(e=>alice.addIceCandidate(e))

    // const inbound_stream = window.inbound = new MediaStream
    // const video = document.querySelector('video')

    // video.srcObject = inbound_stream

    // console.log(bob)
    // bob.onaddstream = e=>{
    //   console.log(e)
    // }
    // bob.ontrack = e=>{
    //   console.log(e)
    //   inbound_stream.addTrack(e.track)
    // }

    // bob.ondatachannel = e=>console.log(e.channel)

    // alice.ontrack = alice.onaddstream = console.log
  </script>
</body>
</html>